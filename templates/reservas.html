{% extends 'layout.html' %}
{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js'></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reservas.css') }}">  
</head>
<body>
    
    <div class="calendar-container" id='calendar'></div>
    <script>

    document.addEventListener('DOMContentLoaded', function() {

      let request_calendar = "{{ url_for('static', filename='data/events.json') }}";
  
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'timeGridWeek',
          contentHeight: 'auto',
          slotDuration: '00:10:00',

          allDaySlot: false,
          editable: false,
          locale: 'es',
          selectable: true,
          select: function(info) {
              // Obtener la fecha de inicio y finalización seleccionadas
              var start = info.startStr; // Fecha de inicio en formato ISO8601
              var end = info.endStr; // Fecha de finalización en formato ISO8601

              if (confirm('¿Deseas guardar esta reserva?')) {
                  // Enviar los datos al backend utilizando fetch API
                  fetch('/guardar_reserva', {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json'
                      },
                      body: JSON.stringify({
                          start: start,
                          end: end
                      })
                  })
                  .then(response => {
                      if (response.ok) {
                          console.log('Reserva guardada con éxito');
                      } else {
                          console.error('Error al guardar la reserva:', response.statusText);
                      }
                  })
                  .catch(error => {
                      console.error('Error al guardar la reserva:', error);
                  });
              }
          },
  
          events:function(info, successCallback, failureCallback){
              fetch(request_calendar)
                  .then(function(response){
                      return response.json()
                  })
                  .then(function(data){
                      let events = data.events.map(function(event){
                          return {
                              title: event.eventTitle,
                              start: new Date(event.eventStartDate),
                              end: new Date(event.eventEndDate),
                              url: event.eventUrl,
                              location: event.eventLocation,
                              timeStart: event.eventStartTime,
                              timeEnd: event.eventEndTime,
                          }
                      })
                      successCallback(events)
                  })
                  .catch(function(error){
                      failureCallback(error)
                  })
          },
  
          eventContent: function(info){
              console.log("Hola Mundo!")
              return {
                  html: `
                  <div style="overflow: hidden; font-size: 12px; positon: relative;  cursor: pointer; font-family: 'Inter', sans-serif;">
                      <div><strong>${info.event.title}</strong></div>
                      <div>Location: ${info.event.extendedProps.location}</div>
                      <div>Date: ${info.event.start.toLocaleDateString(
                          "es-US",
                          {
                              month: "long",
                              day: "numeric",
                              year: "numeric",
                          }
                      )}</div>
                      <div>Time: ${info.event.extendedProps.timeStart} - ${info.event.extendedProps.timeEnd}</div>
                  </div>
                  `
              }
          },
  
          eventMouseEnter: function(mouseEnterInfo){
              console.log(mouseEnterInfo)
              let el = mouseEnterInfo.el
              el.classList.add("relative")
  
              let newEl = document.createElement("div")
              let newElTitle = mouseEnterInfo.event.title
              let newElLocation = mouseEnterInfo.event.extendedProps.location
              newEl.innerHTML = `
                  <div
                      class="fc-hoverable-event"
                      style="position: absolute; bottom: 100%; left: 0; width: 300px; height: auto; background-color: white; z-index: 50; border: 1px solid #e2e8f0; border-radius: 0.375rem; padding: 0.75rem; font-size: 14px; font-family: 'Inter', sans-serif; cursor: pointer;"
                  >
                      <strong>${newElTitle}</strong>
                      <div>Location: ${newElLocation}</div>
  
                  </div>
              `
              el.after(newEl)
          },
  
          eventMouseLeave: function(){
              document.querySelector(".fc-hoverable-event").remove()
          }
      });
      calendar.render();
  });
  </script>
</body>
</html>
{% endblock %}

